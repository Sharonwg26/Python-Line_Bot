# Python - Line Bot

---

## ç–«æƒ…å°å¹«æ‰‹ æ¶æ§‹

----

### å¹³å° â€” LINE
ç–«æƒ…å°å¹«æ‰‹ æ˜¯é€™å€‹ ChatBot çš„åç¨±ï¼Œè€Œ ç–«æƒ…å°å¹«æ‰‹ æ˜¯ä¸€å€‹å»ºç«‹åœ¨ LINE å¹³å°ä¹‹ä¸Šçš„ ChatBotã€‚ä¹‹æ‰€ä»¥é¸æ“‡ä»¥ LINE ç‚ºå¹³å°ï¼Œä¸»è¦åŸå› ä¹Ÿæ˜¯å°ç£å°æ–¼ LINE çš„é«˜åº¦ä¾è³´æ€§æ‰€è‡´ã€‚


---

### æ¶æ§‹ â€” Django
èƒ½å¤ å¯¦ç¾ LINE Bot çš„æ–¹å¼æœ‰å¾ˆå¤šï¼Œç”±æ–¼æˆ‘æ˜¯åƒç…§æ›¸ä¸ŠæŒ‡ç¤ºé€²è¡Œå»ºæ§‹ï¼Œå› æ­¤ä¾¿ä»¥ Django ç‚º ç–«æƒ…å°å¹«æ‰‹ çš„è¨­è¨ˆæ¶æ§‹ã€‚


---

### ä¼ºæœå™¨ â€” heroku
ç›®å‰éè‡ªæ¶ä¼ºæœå™¨çš„é¸æ“‡å¤§å¤šæ˜¯ ngrok ä»¥åŠ herokuï¼Œå‰è€…é‡æ–°åŸ·è¡Œå¾Œéƒ½æœƒæ”¹è®Šç¶²å€ï¼Œå°æ–¼è¦å¸¸æ…‹æ€§ä½¿ç”¨ä¸Šæœƒç›¸å°ä¸æ˜¯é€™éº¼å¥½ç”¨ã€‚
heroku æœ‰å…è²»çš„æ–¹æ¡ˆï¼Œåœ¨æ¶æ§‹ä¸Šåªè¦æ»¿è¶³å…¶è¦æ±‚ï¼Œå¾€å¾Œçš„æ›´å‹•éƒ½åªé ˆèª¿æ•´ä»£ç¢¼å³å¯ï¼Œå…¶é¤˜çš„éƒ½ä¸å¤ªéœ€è¦å¤šæ“å¿ƒï¼Œå¯ä»¥ç®—æ˜¯åˆç´š LINE Bot é–‹ç™¼è€…çš„é¦–é¸ã€‚


---

### è³‡æ–™æ“·å– â€” ç–«æƒ…æŒ‡æ®ä¸­å¿ƒ API
ç¾éšæ®µ ç–«æƒ…å°å¹«æ‰‹ é–‹ç™¼å‡ºä¾†çš„åŠŸèƒ½æœ‰äºŒ :
1. ç•¶æ—¥ç¢ºè¨ºäººæ•¸
2. åœ°å€
   è©¢éƒ¨åˆ†æ¥æ”¶åˆ°è¨Šæ¯å¾Œç¢ºèªå¾…æŸ¥è©¢ç¸£å¸‚å¾Œä¾é ä¸­å¤®æ°£è±¡å±€å…¬é–‹è³‡æ–™ API æ“·å–ã€Œ36å°æ™‚å¤©æ°£é å ±è³‡æ–™ã€è³‡è¨Šï¼Œå°‡æˆ‘å€‘è¦çš„ç¸£å¸‚è³‡è¨ŠæŠ“å‡ºä¾†å†å›è¦†çµ¦ä½¿ç”¨è€…ã€‚

[æ–°å† è‚ºç‚ COVID-19 ç–«è‹—æ¥ç¨®é™¢æ‰€æŸ¥è©¢](https://tools.heho.com.tw/covid-19-vaccine/)
---

### Google YouTube API
å¢åŠ äº†å¯ä»¥æŸ¥è©¢ç•¶æ—¥ç–«æƒ…è¨˜è€…æœƒçš„éƒ¨åˆ†ï¼Œä»¥ç–«æƒ…æŒ‡æ®ä¸­å¿ƒçš„åˆ†æç‚ºçˆ¬èŸ²å°è±¡ã€‚
åˆ©ç”¨ google API å¯ä»¥ç”¨ç°¡å–®çš„æ–¹å¼ä¾†å–å¾— YouTube å…§å®¹ã€‚
    
    
>éº»ç…©å¤§å®¶å¡«å¯« [name=Sharonwg26] 
    
    
---

## åŠŸèƒ½
1. ç–«æƒ… å›å¾©å¤šå°‘
2. é‡é«”æº«ï¼šè¼¸å…¥é«”æº«
3. åœ°å€ æ¯”å°è¶³è·¡
4. ç¯©æª¢ç«™ é™„è¿‘é†«é™¢
5. ç–«è‹— å¯æ–½æ‰“é†«é™¢
6. æ™‚é–“æé†’ è‡ªå®šç¾©
7. æ•™å­¸ç¶²ç«™ ç›¸é—œæ•™å­¸ç¶²ç«™é€£çµ
8. ä¿éšª é˜²ç–«ä¿å–®ç¨®é¡
9. çŒœæ‹³

[å¯ä»¥çš„è¯æ–‡å­—å¯ä»¥åŠ ä¸€äº›emojiæˆ–è€…è¡¨æƒ…ï¼Œçœ‹èµ·æ¥æ¯”è¾ƒæœ‰è¶£]


---

## åˆ†å·¥
* å®‰å®‰
    * ä¿é™©
    * ç­›æ£€ç«™
    * æ—¶é—´æé†’ ï¼ˆXï¼‰
* ä¸ä¸
    * æ•™å­¦ç½‘ç«™
    * ç¸£å¸‚ä»Šæ—¥ç–«æƒ…ï¼ˆæ–°å¢ç¢ºè¨ºï¼‰
* æ²‚è±
    * ç–«æƒ…ï¼šå…¨çƒç–«æƒ…ï¼ˆç´¯è¨ˆã€æ­»äº¡ï¼‰ã€å°ç£ç–«æƒ…ï¼ˆç´¯è¨ˆã€æœ¬åœŸã€å¢ƒå¤–ã€æ­»äº¡ï¼‰ã€ä»Šæ—¥ç–«æƒ…ï¼ˆç´¯è¨ˆã€æœ¬åœŸã€å¢ƒå¤–ï¼‰ã€ç¸£å¸‚ç–«æƒ…ï¼ˆç´¯è¨ˆï¼‰
    * çŒœæ‹³
    * ğŸ·
    > ???
* è»’åªš
    * ç–«è‹—
    * é‡é«”æº«
    * å¤©æ°£ï¼ˆæ°£è±¡å±€APIï¼‰

---

## Line Bot
1. Channel secret 
    `69a5b0ff850e58d346a7695507d98177`
2. Channel access token
```
OQqOlMprRqeiXhBHSymZ45X+i7WF74swYPh3nYpgcrVezoVQQ726Eqh2e0oBORceRt+brhEoSIC6W61E4H3bxGOg4Wp51V/XsG4QW4fIkPNrb/leolZ31igBf2WZd0cTnKS86EFUUWQy2TZNgHu6ugdB04t89/1O/w1cDnyilFU=
```
3. [ä¸­å¤®æ°£è±¡å±€APIæˆæ¬Šç¢¼](https://opendata.cwb.gov.tw/user/authkey)
```
CWB-E5F5EFC0-30D2-43E6-B9C5-DDC64B24FA74
```
---

![](https://i.imgur.com/sFhZgIx.png)
* æ„Ÿè§‰å¤§å®¶å¯èƒ½ä¼šéœ€è¦è¿™ä¸ª


---

## Code
* å°‡ç¨‹å¼ç¢¼æ¨ä¸Š Herokuï¼Œå¦‚æœæœ‰è·³å‡ºéŒ¯èª¤è«‹é‡æ–°è¼¸å…¥
```
git add .
git commit -m "Add code"
git push -f heroku main
```


----

### åŸºç¤é€£æ¥
```python=
from flask import Flask, request, abort

from linebot import (
    LineBotApi, WebhookHandler
)
from linebot.exceptions import (
    InvalidSignatureError
)
from linebot.models import *

app = Flask(__name__)

# Channel Access Token
line_bot_api = LineBotApi('OQqOlMprRqeiXhBHSymZ45X+i7WF74swYPh3nYpgcrVezoVQQ726Eqh2e0oBORceRt+brhEoSIC6W61E4H3bxGOg4Wp51V/XsG4QW4fIkPNrb/leolZ31igBf2WZd0cTnKS86EFUUWQy2TZNgHu6ugdB04t89/1O/w1cDnyilFU=
')
# Channel Secret
handler = WebhookHandler('69a5b0ff850e58d346a7695507d98177')

# ç›£è½æ‰€æœ‰ä¾†è‡ª /callback çš„ Post Request
@app.route("/callback", methods=['POST'])
def callback():
    # get X-Line-Signature header value
    signature = request.headers['X-Line-Signature']
    # get request body as text
    body = request.get_data(as_text=True)
    app.logger.info("Request body: " + body)
    # handle webhook body
    try:
        handler.handle(body, signature)
    except InvalidSignatureError:
        abort(400)
    return 'OK'

# è™•ç†è¨Šæ¯
@handler.add(MessageEvent, message=TextMessage)
def handle_message(event):
    message = TextSendMessage(text='Hello, world')
    line_bot_api.reply_message(event.reply_token, message)

import os
if __name__ == "__main__":
    port = int(os.environ.get('PORT', 5000))
    app.run(host='0.0.0.0', port=port)

```


----

### çˆ¬çˆ¬çˆ¬
```python=
from bs4 import BeautifulSoup
from abc import ABC, abstractmethod
import requests

response = request.get("https://covid-19.nchc.org.tw")
soup = BeautifulSoup(response.content, "html.parser")
newly_increased = soup.find('h1', {'class': 'country_confirmed mb-1 text-success'}).getText()

print(newly_increased)
```


---

## åƒè€ƒ

* [[Flask â€“ LINE Bot æ•™å­¸] äº‹å‰æº–å‚™ç¯‡ (ä¸€)](https://www.maxlist.xyz/2020/11/16/flask-line-bot-pre-set/)
* [LineBot+Pythonï¼Œè¼•é¬†å»ºç«‹èŠå¤©æ©Ÿå™¨äºº](https://blackmaple.me/line-bot-tutorial/)
* [LINE Messaging API SDK for Python](https://github.com/line/line-bot-sdk-python)
* [Python Telegram Bot æ•™å­¸ (by é™³é”ä»)](https://hackmd.io/@truckski/HkgaMUc24?type=view)

